<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MystriX+ Live</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="live_mystrix+.css" />
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  </head>
  <body id="live-page">
    <a class="brand-pin" href="index.html" title="Home">
      <img src="mystrix_logo.png" alt="MystriX by Wolf House" />
      <div class="brand-globe" aria-hidden="true"></div>
    </a>
    <main class="live-shell">
      <header class="live-hero glass-card">
        <h1>MystriX+ Live Console</h1>
        <p>Real-time divergence hunter with ML validation, signal announcer, and auto trader bridge.</p>
        <div class="live-links">
          <a href="magic_v2.html">Back to Lab</a>
          <button id="refresh-live" type="button">Refresh</button>
        </div>
      </header>

      <section class="glass-card asset-panel">
        <div class="panel-head">
          <h2>Asset Window</h2>
          <div class="toggles">
            <label class="toggle">
              <input id="hunter-toggle" type="checkbox" />
              <span>Divergence Hunter</span>
            </label>
          </div>
        </div>
        <p>Select up to 20 assets. Divergence hunter runs concurrently across the enabled set.</p>
        <div class="asset-toolbar">
          <input id="asset-search" list="asset-options" type="text" placeholder="Search symbols (BTC, ETH, SOL...)" />
          <datalist id="asset-options"></datalist>
          <button id="asset-add" type="button">Add Asset</button>
        </div>
        <div id="asset-list" class="asset-grid"></div>
        <div class="asset-actions">
          <button id="select-all" type="button">Select All</button>
          <button id="clear-all" type="button">Clear</button>
        </div>
        <div class="suggested-panel">
          <div class="suggested-head">
            <h3>Suggested 24h Universe</h3>
            <div class="suggested-actions">
              <label class="toggle auto-universe-toggle">
                <input id="auto-universe-toggle" type="checkbox" />
                <span>Auto Sync</span>
              </label>
              <button id="refresh-suggested" type="button">Refresh</button>
            </div>
          </div>
          <p id="suggested-status">Loading suggestions...</p>
          <div id="suggested-list" class="suggested-list"></div>
        </div>
        <div class="favorites-panel">
          <div class="favorites-head">
            <h3>Favorites</h3>
            <span class="favorites-hint">Tap ☆ to favorite, ★ to unfavorite.</span>
          </div>
          <p id="favorites-empty">No favorites yet.</p>
          <div id="favorites-list" class="favorites-list"></div>
        </div>
      </section>

      <section class="glass-card control-panel">
        <h2>Live Controls</h2>
        <div class="control-grid">
          <label>Dataset Path
            <input id="live-dataset" type="text" value="ml_pipeline/data/div_all_3m.csv" />
          </label>
          <label class="toggle">
            <input id="paper-toggle" type="checkbox" checked />
            <span>Paper Mode</span>
          </label>
          <label>Model Path
            <input id="live-model" type="text" value="ml_pipeline/models/ml_filter.pkl" />
          </label>
          <label>ML Threshold
            <span class="range-wrap">
              <input id="live-threshold" type="range" min="0.55" max="0.95" step="0.01" value="0.65" />
              <span id="live-threshold-val" class="badge">0.65</span>
            </span>
          </label>
          <label>Events per Pulse
            <input id="live-count" type="number" min="1" max="20" value="3" />
          </label>
          <label>Balance
            <div class="balance-pill">
              <div>
                <span id="balance-amount">$0.00</span>
                <small id="balance-status">idle</small>
              </div>
              <button id="refresh-balance" type="button" aria-label="Refresh balance">Refresh</button>
            </div>
            <ul id="balance-breakdown" class="balance-breakdown">
              <li>Awaiting sync...</li>
            </ul>
          </label>
          <label class="toggle">
            <input id="autotrader-toggle" type="checkbox" />
            <span>Auto Trader</span>
          </label>
          <label>Status
            <div class="status-pill idle" id="live-status">
              <span class="dot"></span>
              <span class="label">Idle</span>
            </div>
          </label>
          <div class="start-cell">
            <button id="start-live" class="cta start-btn" type="button">Start Live Feed</button>
          </div>
        </div>
        <div class="status-board">
          <div class="status-card idle" data-status="live">
            <span class="status-title">Live Feed</span>
            <span class="status-state">Stopped</span>
          </div>
          <div class="status-card idle" data-status="hunter">
            <span class="status-title">Hunter</span>
            <span class="status-state">Idle</span>
          </div>
          <div class="status-card idle" data-status="auto">
            <span class="status-title">AutoTrader</span>
            <span class="status-state">Idle</span>
          </div>
        </div>
        <div class="status-feed" id="status-feed">
          <p class="status-note idle">System ready. Configure assets and start the live feed.</p>
        </div>
      </section>

      <section class="glass-card pulse-card">
        <div class="pulse-head">
          <h2>Scanner Pulse</h2>
          <div class="heartbeat-anim idle" id="heartbeat-indicator">
            <span class="beat-dot"></span>
            <span class="beat-label" id="heartbeat-label">Idle</span>
          </div>
        </div>
        <p class="pulse-meta" id="heartbeat-meta">No pulses yet.</p>
        <ul id="pulse-feed" class="pulse-feed">
          <li data-empty="true">Waiting for scans...</li>
        </ul>
        <div class="pulse-actions">
          <button id="demo-trade-btn" class="cta demo-btn" type="button">
            Fire Demo Trade (BNB - 500 USDT - 45s)
          </button>
        </div>
      </section>

      <section class="glass-card">
        <div class="panel-head">
          <h2>Signal Feed</h2>
          <div class="signal-actions">
            <button id="export-csv" type="button">Export CSV Report</button>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Symbol</th>
                <th>Divergence</th>
                <th>Entry Time</th>
                <th>Exit Time</th>
                <th>Entry Px</th>
                <th>Exit Px</th>
                <th>Trade Size</th>
                <th>Ret %</th>
                <th>PNL ($)</th>
                <th>Confidence</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="live-log">
              <tr><td colspan="12" style="text-align:center;opacity:.6;">Awaiting signals...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="glass-card trade-monitor">
        <div class="panel-head">
          <h2>Trade Monitor</h2>
          <div class="monitor-badges">
            <span class="monitor-badge" id="level-badge">Level --</span>
            <span class="monitor-badge" id="risk-badge">Risk --</span>
          </div>
        </div>
        <div class="monitor-grid">
          <div class="monitor-panel">
            <h3>Compounding Tracker</h3>
            <div class="level-stats">
              <div class="level-stat">
                <span class="stat-label">Current Level</span>
                <span id="level-current">--</span>
              </div>
              <div class="level-stat">
                <span class="stat-label">Level Balance</span>
                <span id="level-balance">$0.00</span>
              </div>
              <div class="level-stat">
                <span class="stat-label">Target</span>
                <span id="level-target">$0.00</span>
              </div>
              <div class="level-stat">
                <span class="stat-label">Risk</span>
                <span id="level-risk">$0.00</span>
              </div>
              <div class="level-stat">
                <span class="stat-label">Ending Balance</span>
                <span id="level-ending">$0.00</span>
              </div>
            </div>
            <div class="pnl-chart-wrap">
              <canvas id="pnl-chart" width="520" height="220"></canvas>
            </div>
            <div class="pnl-total">
              <span>Total Realized PnL</span>
              <strong id="pnl-total">$0.00</strong>
            </div>
          </div>
          <div class="monitor-panel">
            <h3>Open Trades</h3>
            <form id="manual-trade-form" class="manual-form">
              <input id="manual-symbol" list="asset-options" type="text" placeholder="Search asset (e.g. BTC/USDT)" required />
              <select id="manual-side">
                <option value="long">Long</option>
                <option value="short">Short</option>
              </select>
              <input id="manual-size" type="number" step="0.01" placeholder="Total size (USDT)" required />
              <input id="manual-leverage" type="number" step="0.1" min="1" value="1" placeholder="Leverage (x)" required />
              <input id="manual-entry" type="number" step="0.0001" placeholder="Entry price" required />
              <input id="manual-sl" type="number" step="0.0001" placeholder="Stop loss (price)" />
              <input id="manual-tp" type="number" step="0.0001" placeholder="Take profit (price)" />
              <button type="submit">Log Manual Trade</button>
            </form>
            <div class="manual-hint">Margin used = total size / leverage.</div>
            <form id="live-order-form" class="manual-form live-order-form">
              <input id="live-order-symbol" list="asset-options" type="text" placeholder="Live order symbol (e.g. BTC/USDT)" required />
              <select id="live-order-side">
                <option value="buy">Buy</option>
                <option value="sell">Sell</option>
              </select>
              <input id="live-order-notional" type="number" step="0.01" placeholder="Notional (USDT)" required />
              <button type="submit">Place Live Test Order</button>
            </form>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Source</th>
                    <th>Symbol</th>
                    <th>Side</th>
                    <th>Entry</th>
                    <th>SL</th>
                    <th>TP</th>
                    <th>Size</th>
                    <th>Lev</th>
                    <th>Margin</th>
                    <th>Last Px</th>
                    <th>Float PnL</th>
                    <th>Opened</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="open-trades-body">
                  <tr><td colspan="14" style="text-align:center;opacity:.6;">No open trades.</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section class="glass-card">
        <h2>Rejected Divergences</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Symbol</th>
                <th>Divergence</th>
                <th>Entry</th>
                <th>Exit</th>
                <th>Confidence</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tbody id="reject-log">
              <tr><td colspan="7" style="text-align:center;opacity:.6;">No rejections yet.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="glass-card">
        <div class="panel-head">
          <h2>Auto Trader Log</h2>
          <div class="auto-actions">
            <button id="open-autotrader-settings" type="button">Edit Config</button>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Symbol</th>
                <th>Side</th>
                <th>Size</th>
                <th>Status</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="auto-log">
              <tr><td colspan="6" style="text-align:center;opacity:.6;">Auto trader idle.</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
    <div id="toast-stack" class="toast-stack"></div>
    <div id="screensaver" class="screensaver" aria-hidden="true">
      <div class="saver-label">MystriX card diagnostics - idle mode</div>
      <div id="saver-canvas-wrap" class="saver-canvas-wrap"></div>
    </div>
    <button class="theme-switch theme-switch-floating" data-theme-toggle type="button">Theme</button>
    <script src="theme_toggle.js" defer></script>
    <script src="live_mystrix+.js" defer></script>
  </body>
</html>
